## Spring HTML Form Tags (`form:`)

**정의**: 스프링 프레임워크가 JSP에서 HTML form을 더 쉽게 작성하고, 자바 객체와 자동으로 바인딩하기 위해 제공하는 커스텀 태그 라이브러리

- **선언**
    - `<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>`

<br>

### 기본 태그

1. `form:form`
    - **정의**: HTML `<form>` 태그를 대체하는 스프링 전용 폼 태그
    - **기능**: `modelAttribute` 속성을 통해 해당 폼이 어떤 자바 객체와 연결되는지 명시

2. `form:input`
    - **정의**: HTML `<input type="text">`를 대체하는 입력 필드
    - **기능**: `path` 속성을 사용. 해당 `path`는 연결된 자바 객체의 필드명과 일치해야 함
        - (조회 시) 자바 객체에 들어있는 값을 자동으로 꺼내와서 화면에 보여줌
        - (제출 시) 입력한 값을 해당 필드 이름으로 전송

3. `form:label`
    - **정의**: 입력 필드에 대한 설명을 표시하는 태그
    - **기능**: `path` 속성을 지정하면, 해당 입력 필드의 `id`를 `for` 속성으로 자동 매핑

4. `form:errors`
    - **정의**: 검증 실패 시 발생하는 에러 메시지를 화면에 출력하는 태그
    - **기능**:  `path` 속성을 지정하면, 해당 필드에서 발생한 에러를 보여줌

<br>
<br>

## 양방향 바인딩

**정의**: Java Bean과 JSP 양쪽 방향으로 자동 동기화되는 메커니즘

<br>

### Bean → JSP (조회)

- **상황**: 어느 페이지에 들어왔을 때
- **동작:**
    1. 컨트롤러가 DB에서 `Todo` 객체를 가져와서 `Model`에 담음
    2. JSP가 로딩될 때, `form:input` 태그가 `Todo` 객체의 `getter` 호출
    3. DB에 저장되어 있던 값들이 입력창에 미리 채워진 상태로 화면 출력

<br>

### JSP → Bean (제출)

- **상황**: submit 버튼을 눌렀을 때
- 동작:

    1\. `submit`을 누르면 `Todo`를 보내는 게 아닌 문자열 조각들을 보냄

    2\. 서버에 요청이 도착하고, 메서드를 실행하려고 보니, `Todo` 객체가 필요한 것을 발견

    3\. 우선, `new Todo`로 **빈 객체 생성** 
    
    4\. 브라우저가 보낸 **문자열 조각들을 매칭**시킴

<br>
<br>

## 스프링 MVC 데이터 바인딩 과정**(`HandlerMethodArgumentResolver`**)

- 브라우저에서 저장 버튼을 눌렀을 때, 컨트롤러 메서드가 실행되기 직전까지 발생하는 과정
- 자바 리플렉션: [1.10 리플렉션(Reflection)](../01-details/1.10-reflection.md#리플렉션(reflection))

<br>

1. **ArgumentResolver 호출**
- `DispatcherServlet`이 컨트롤러의 메서드를 호출하려고 보니, 파라미터로 `Todo` 객체가 필요하다는 걸 발견
    - → 해당 객체를 만들 `HandlerMethodArgumentResolver`를 찾음 
    (객체 바인딩의 경우에는 `ModelAttributeMethodProcessor`)

2. **리플렉션을 사용해 빈 객체 생성** 
- `BeanUtils.instantiateClass(Todo.class)` 호출
- 스프링은 클래스의 **기본 생성자**를 찾음
    - **있으면** → 빈 객체 생성
    - **없으면** → 인자가 있는 생서자를 찾아서, null or 기본값을 넣고 생성 시도

3. **데이터 바인딩 (`WebDataBinder`)**
- JSP에서 날아온 데이터를 **객체 필드에 넣음**
- (JSP → 자바 필드) 타입 변환도 자동으로 해줌
    - e.g. JSP에서 “2026-01-30”(문자열)을 보냈는데 자바 필드가 `LocalDate`면, LocalDate로 자동으로 타입 변환

4. **검증 및 주입**
- 값이 다 채워진 후, `@Valid` 같은 어노테이션이 있다면 검증 로직 실행
- 모든 과정이 끝나면 `Todo` 객체를 컨트롤러 메서드 인자로 전달하고, 
처음 호출했던 메서드를 이제 실행함

<br>

### HandlerMethodArgumentResolver

**정의**: 컨트롤러 메서드의 파라미터를 보고, 그 파라미터를 생성할 수 있는 전략 인터페이스 

- **객체 바인딩 담당**: `ModelAttributeMethodProcessor`
- `@RequestParam` **담당**: `RequestParamMethodArgumentResolver`

<br>

### WebDataBinder

**정의**: HTTP 요청 파라미터를 자바 객체로 바인딩해주는 클래스

- 타입 불일치를 해결해줌

<br>
<br>

## 스프링 검증 어노테이션

### @Valid

**정의**: 해당 어노테이션이 붙은 객체를 검사하는 어노테이션

**기능**: 해당 어노테이션이 붙은 객체는, 설정된 제약 조건을 위반했는지 확인

```java
// @Valid 사용 예시
@PostMapping("update-todo")
public String updateTodo(ModelMap model, **@Valid** Todo todo, BindingResult result, Principal principal) {
```

<br>

### @Size

**정의**: 문자열이나 리스트의 길이를 제한하는 제약조건 어노테이션

**기능**: `min`(최소값), `max`(최대값), `message`(에러시 보여줄 문구)를 설정할 수 있음

```java
// @Size 사용 예시
@Size(min=10, message="Enter atleast 10 Characters")
private String task;
```

<br>
<br>

## Predicate & removeIf 문법

### Predicate

**정의**: true 또는 false를 반환하는 함수형 인터페이스

**기능**: 조건 검사 필터로 사용

<br>

### removeIf

**정의**: 조건에 맞는 것들을 모두 지우는 명령어

**기능**: 인자로 `Predicate`를 받아서, 리스트를 전부 돌면서 `Predicate`가 `true`를 반환하는 요소를 삭제함

```java
// Predicate & removeIf 사용 예시
Predicate<? super Todo> predicate = todo -> todo.getId() == id;
todos.removeIf(predicate);
```

<br>
<br>

## Validations with Spring Boot

- 스프링 검증 라이프사이클

<br>

1. **spring-boot-starter-validation**
- 의존성 추가

2. **Command Bean (Form Backing Object)**
- **정의**: Form 데이터를 받아주는 자바 객체
- **특징**
    - **Form Backing Object**: Form의 뒷배경이 되는 객체 (검증의 대상)
    - **양방향 바인딩**: 폼의 입력값과 객체의 필드가 묶여 있음

3. **Bean에 Validation 추가**
- Command Bean 클래스에 있는 필드 위에 규칙을 추가하는 단계
- **주요 어노테이션**
    - `@NotNull`
    - `@NotEmpty`
    - `@Past` / `@Future`

4. **Validation 에러를 View에 표시**
- 컨트롤러에서 검증 실패 시, 에러 정보를 화면으로 보내는 과정
- **BindingResult**
    - `@Valid` 바로 뒤에는 반드시 `BindingREsult` 파라미터가 있어야 함
    - BindingResult에 에러 내용이 담김

```java
// BindingResult 사용 예시
// 진짜로 순서상 @Valid 변수 뒤에 위치해야 함
@PostMapping("update-todo")
    public String updateTodo(ModelMap model, @Valid Todo todo, BindingResult result, Principal principal) {
```

<br>
<br>

## @GeneratedValue

- **정의**: 기본키 값을 자동으로 생성해 주는 전략을 설정하는 어노테이션